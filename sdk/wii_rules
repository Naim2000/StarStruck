ifeq ($(strip $(DEVKITARM)),)
$(error "Please set DEVKITARM in your environment. export DEVKITARM=<path to>devkitARM")
endif

include $(DEVKITARM)/base_rules

ifeq ($(SPECS),)
SPECSFLAGS = -specs $(SDKDIR)/starlet.specs
else
SPECSFLAGS = -specs $(SPECS)
endif

LIB_INC  = -I $(SDKDIR)/include -I $(SDKDIR)/../core/include
LIB_DIR  = -L $(SDKDIR)/../core/lib
ARCH 	 = -mbig-endian -mcpu=arm926ej-s -nostartfiles
CFLAGS 	 = $(ARCH) -Wall -Wextra -Os -fomit-frame-pointer -ffunction-sections -pipe -g -Wconversion $(LIB_INC)
CXXFLAGS = $(CFLAGS)
ASFLAGS  = $(ARCH) 
LDFLAGS  = $(ARCH) -n
LIBDIRS  = 
SDKLIBS  = $(SDKDIR)/lib/libc.a $(SDKDIR)/lib/libm.a $(SDKDIR)/lib/libg.a 


%.elf:
	$(SILENTMSG) linking $(notdir $@)
	$(SILENTCMD)$(LD) $(LIB_DIR) $(LDFLAGS) $(SPECSFLAGS) $(OFILES) -o $@ $(LIBPATHS) $(LIBS) -L$(SDKDIR)/lib $(LIBS) -lgcc $(SDKLIBS)
	$(SILENTCMD)$(NM) -CSn $@ > $(notdir $*.lst)
	
%.a:
	$(SILENTMSG) archiving $(notdir $@)
	$(SILENTCMD)rm -f $@
	$(SILENTCMD)$(AR) -rc $@ $(OFILES)
	$(SILENTCMD)$(RANLIB) $@